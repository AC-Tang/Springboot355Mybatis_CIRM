<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.springboot355mybatis_cirm.mapper.ArticleMapper">
    <resultMap id="articleInfo" type="com.example.springboot355mybatis_cirm.dto.ArticleInfo">
        <id property="articleId" column="articleId" />
        <result property="title" column="title" />
        <result property="summary" column="summary" />
        <result property="publishTime" column="publishTime" />
        <result property="createTime" column="createTime" />
        <result property="status" column="status"/>
        <result property="isTop" column="isTop" />
        <result property="updateTime" column="updateTime" />
        <result property="authorId" column="authorId" />
        <result property="content" column="content" />
        <result property="categoryId" column="categoryId" />
        <result property="tag" column="tag"/>
        <result property="pageViews" column="pageViews"/>
        <result property="coverImagePath" column="coverImagePath"/>
        <result property="categoryName" column="categoryName" />
        <result property="userName" column="userName" />
        <result property="realName" column="realName" />
    </resultMap>
    <select id="getAllArticleInfo" resultMap="articleInfo">
        SELECT
            a.article_id AS articleId,
            a.title,
            a.summary,
            a.publish_time AS publishTime,
            a.create_time AS createTime,
            a.status,
            a.is_top AS isTop,
            a.update_time AS updateTime,
            a.author_id AS authorId,
            a.content,
            a.category_id AS categoryId,
            a.tag,
            a.page_views AS pageViews,
            a.cover_image_path as coverImagePath,
            c.name AS categoryName,
            u.user_name AS userName,
            u.real_name AS realName
        FROM
            article a
                LEFT JOIN
            category c ON a.category_id = c.category_id
                left join
            user u on a.author_id = u.user_id
        <where>
            <!-- 逻辑删除默认过滤 -->
            <if test="isDelete != null">
                AND a.is_delete = #{isDelete}
            </if>
            <if test="isDelete == null">
                AND a.is_delete = 0
            </if>

            <!-- 作者过滤 -->
            <if test="authorId != null">
                AND a.author_id = #{authorId}
            </if>

            <if test="status != null">
                AND a.status != #{status}
            </if>
            <if test="status == null">
                AND a.status = 0
            </if>
        </where>
        ORDER BY a.publish_time DESC
    </select>
</mapper>